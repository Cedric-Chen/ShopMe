<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <title> Admin Page</title>

    <link href="{{ url_for('static', filename='css/index.css') }}" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

     Font Awesome
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<!--
<style>
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 180px;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}
.dropdown a:hover {background-color: #f1f1f1}

.show {display:block;}
</style>
-->

<style>
* {
  box-sizing: border-box;
}

#searchbox-kw {
  width: 80%;
  font-size: 16px;
  padding: 12px 20px 12px 10px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
  display:inline-block
}
#mybutton {
  width: 19%;
  font-size: 16px;
  padding: 12px 2px 12px 4px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
}

#myTable {
  border-collapse: collapse;
  width: 100%;
  border: 1px solid #ddd;
  font-size: 18px;
}

#myTable th, #myTable td {
  text-align: left;
  padding: 12px;
}

#myTable tr {
  border-bottom: 1px solid #ddd;
}

#myTable tr.header, #myTable tr:hover {
  background-color: #f1f1f1;
}
</style>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>


<body>
  {% include "navbar.html" %}

<div class='container col-md-10 col-md-offset-1'>

<form method='post' action="{{ url_for("admin_account_search") }}">
<input type="text" id="searchbox-kw" name="kw" placeholder="Please enter your search condition"  style=''>
<button id='mybutton' type="submit">Search</button>
</form>

<table id="myTable">
  <tr class="header">
    <th>
	{% if kw is defined %}
	<input type='checkbox' id='globalCheckbox'>
        &nbsp;&nbsp;<a onclick="globalDelete('{{kw}}')" >
	<i class="fa fa-trash"></i></a>
	&nbsp;&nbsp;
	<a href = "{{ url_for("admin_account_search") +'/'+ kw}}">
	<i class="fa fa-refresh"></i>
	</a>
	{% else %}
	<input type='checkbox' id='globalCheckbox' style="display:none;">
        &nbsp;&nbsp;	<i class="fa fa-trash" style="display:none;"></i>
	&nbsp;&nbsp;
	<i class="fa fa-refresh" style="display:none;"></i>

	{% endif %}
    </th>
    <th style="width:auto;">Name</th>
    <th style="width:auto;">Location</th>
    <th style="width:auto;">Stars</th>
  </tr>
  {% if business_list is defined %}
  {% for business in business_list %}
  <tr>
    <td><input class='checkBox' type='checkbox'>
        &nbsp;&nbsp;
	<a href="{{ url_for("admin_account_delete") + kw +'/'+ business['id'] }}">
		<i class="fa fa-trash"></i>
	</a>
	&nbsp;&nbsp;
	<a id="refresh_button_{{business['id'] }}" 
		onclick='$("#update_{{business["id"]}}").toggle(500)'
		>
	<i class="fa fa-refresh"></i>
	</a>
    </td>
    <td>{{ business['name'] }}</td>
    <td>{{ business['city'] + ' ' + business['state'] }}</td>
    <td>{{ business['stars'] }}</td>
  </tr>

  <tr id='update_{{business["id"]}}' style='display:none;'>
    <td></td>
    <td>
	<form method='post' action='{{ url_for("admin_account_update") + kw + '/' + business['id'] }}'>
	<table cellspacing="0" cellpadding="0" style='border:none;'>
	<tr><td><h6>Set new username</h6></td>
		<td><input class='text' name='new_username'></td>
	<tr><td><h6>Set new password</h6></td>
		<td><input class='text' name='new_password'></td>
	<tr><td></td>
		<td><button type='submit'> Submit </button></td>
	</table>
	</form>
    </td>
    <td></td>
    <td></td>
  </tr>
{% endfor %}
  {% endif %}
</table>

</div>
</body>


<script>
        $('#globalCheckbox').click(function(){
            if($(this).prop("checked")) {
                $(".checkBox").prop("checked", true);
            } else {
                $(".checkBox").prop("checked", false);
            }                
        });


        $('.checkBox').click(function(){
            if($(".checkBox").length == $(".checkBox:checked").length) {
                $("#globalCheckbox").prop("checked", true);
            }else {
                $("#globalCheckbox").prop("checked", false);            
            }
        });

{% if kw is defined %}
    function globalDelete(kw) {
        console.log('hello world');
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200){
                document.write(xhttp.responseText);
            }
        };

        var boxs = document.getElementsByClassName('checkBox');
        var del_ids = [];
        for(i=0; i<boxs.length; i++) {
            if(boxs[i].checked) {
                var del_url = boxs[i].nextElementSibling.href;
                var value = del_url.split('/');
                id = value[value.length-1];
                del_ids.push(id);
            }
        }
        id_str = del_ids.join('~')
        console.log(id_str)
        xhttp.open("POST", '{{url_for("admin_account_delete_group")}}'+kw+'/', true);
	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(id_str);
    }
{% endif %}
</script>
